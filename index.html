<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Brawl Web</title>
<style>
html,body{
  margin:0; padding:0;
  width:100%; height:100%;
  background:#111;
  overflow:hidden;
}
canvas{display:block}
#selectScreen{
  position:fixed; inset:0;
  background:#000e; color:white;
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  z-index:10;
}
button{
  font-size:22px;
  padding:12px 20px;
  margin:8px;
  border-radius:12px;
}
#restartBtn{
  position:fixed;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  display:none;
  z-index:20;
}
</style>
</head>
<body>

<div id="selectScreen">
  <h2>ë¸Œë¡¤ëŸ¬ ì„ íƒ</h2>
  <button id="tankBtn">ğŸ›¡ï¸ íƒ±ì»¤</button>
</div>

<button id="restartBtn">ğŸ” ë‹¤ì‹œí•˜ê¸°</button>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
window.addEventListener("resize",resize);
resize();

/* ì´ë¯¸ì§€ */
const playerImg = new Image();
playerImg.src = "player.jpg";

/* ì‚¬ìš´ë“œ */
const bgmBattle = new Audio("bgm_battle.mp3");
const bgmWin = new Audio("bgm_win.mp3");
const bgmLose = new Audio("bgm_lose.mp3");
bgmBattle.loop = true;

/* ê²Œì„ ìƒíƒœ */
let started=false;
let gameOver=false;

/* ì‡¼ë‹¤ìš´ */
let center={x:canvas.width/2,y:canvas.height/2};
let safeRadius=Math.min(canvas.width,canvas.height)/2-40;

/* í”Œë ˆì´ì–´ */
const player={
  x:canvas.width/2,
  y:canvas.height*0.75,
  r:20,
  hp:140,
  maxHp:140,
  speed:2,
  idle:0
};

/* AI */
const bots=[];
for(let i=0;i<3;i++){
  bots.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    r:18,
    hp:100,
    maxHp:100,
    speed:1.6
  });
}

/* ì¥ì• ë¬¼ */
const blocks=[
  {x:canvas.width/2-40,y:canvas.height/2-40,w:80,h:80}
];

/* ì…ë ¥ */
let touchX=player.x,touchY=player.y;
canvas.addEventListener("touchmove",e=>{
  const t=e.touches[0];
  touchX=t.clientX;
  touchY=t.clientY;
});

/* ì„ íƒ */
document.getElementById("tankBtn").onclick=()=>{
  document.getElementById("selectScreen").style.display="none";
  started=true;
  bgmBattle.play().catch(()=>{});
};

/* ì¬ì‹œì‘ */
document.getElementById("restartBtn").onclick=()=>{
  location.reload();
};

/* ì²´ë ¥ë°” */
function hpBar(o){
  ctx.fillStyle="red";
  ctx.fillRect(o.x-20,o.y-o.r-12,40,6);
  ctx.fillStyle="lime";
  ctx.fillRect(o.x-20,o.y-o.r-12,40*(o.hp/o.maxHp),6);
}

/* ì—…ë°ì´íŠ¸ */
function update(){
  if(!started||gameOver) return;

  // ì´ë™
  let dx=touchX-player.x;
  let dy=touchY-player.y;
  let dist=Math.hypot(dx,dy);
  if(dist>5){
    player.x+=dx/dist*player.speed;
    player.y+=dy/dist*player.speed;
    player.idle=0;
  }else{
    player.idle++;
    if(player.idle>60 && player.hp<player.maxHp)
      player.hp+=0.05;
  }

  // ë§µ ë°– ì œí•œ
  let d=Math.hypot(player.x-center.x,player.y-center.y);
  if(d>safeRadius){
    player.hp-=0.2;
    player.x=center.x+(player.x-center.x)*safeRadius/d;
    player.y=center.y+(player.y-center.y)*safeRadius/d;
  }

  // AI
  bots.forEach(b=>{
    if(b.hp<=0) return;
    let tx=player.x-b.x;
    let ty=player.y-b.y;
    let td=Math.hypot(tx,ty);
    b.x+=tx/td*b.speed;
    b.y+=ty/td*b.speed;
    if(td<30) player.hp-=0.2;
    let bd=Math.hypot(b.x-center.x,b.y-center.y);
    if(bd>safeRadius) b.hp-=0.3;
  });

  // ì‚¬ë§
  if(player.hp<=0){
    gameOver=true;
    bgmBattle.pause();
    bgmLose.play();
    restartBtn.style.display="block";
  }
  if(bots.every(b=>b.hp<=0)){
    gameOver=true;
    bgmBattle.pause();
    bgmWin.play();
    restartBtn.style.display="block";
  }
}

/* ê·¸ë¦¬ê¸° */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // ì‡¼ë‹¤ìš´
  ctx.strokeStyle="green";
  ctx.lineWidth=4;
  ctx.beginPath();
  ctx.arc(center.x,center.y,safeRadius,0,Math.PI*2);
  ctx.stroke();

  // ì¥ì• ë¬¼
  ctx.fillStyle="#555";
  blocks.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));

  // í”Œë ˆì´ì–´
  ctx.drawImage(playerImg,player.x-player.r,player.y-player.r,player.r*2,player.r*2);
  hpBar(player);

  // AI
  ctx.fillStyle="red";
  bots.forEach(b=>{
    if(b.hp>0){
      ctx.beginPath();
      ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
      ctx.fill();
      hpBar(b);
    }
  });

  if(gameOver){
    ctx.fillStyle="white";
    ctx.font="40px sans-serif";
    ctx.fillText("GAME OVER",canvas.width/2-120,canvas.height/2);
  }
}

/* ë£¨í”„ */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
